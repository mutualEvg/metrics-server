# Reset Generator

A code generation utility that automatically generates `Reset()` methods for Go structs.

## Overview

This tool scans your codebase for structs marked with a `// generate:reset` comment and generates `Reset()` methods that reset the struct's fields to their zero values according to specific rules.

## Usage

Run the generator from the project root:

```bash
go run cmd/reset/main.go
```

Or from a specific directory:

```bash
go run cmd/reset/main.go /path/to/directory
```

## How to Mark Structs

Add a `// generate:reset` comment directly above any struct definition:

```go
// generate:reset
type MyStruct struct {
    Counter int
    Name    string
    Tags    []string
    Data    map[string]int
}
```

## Reset Rules

The generated `Reset()` method follows these rules:

### 1. Primitives
Primitives are reset to their zero values:
- `int`, `int8`, `int16`, `int32`, `int64` → `0`
- `uint`, `uint8`, `uint16`, `uint32`, `uint64` → `0`
- `float32`, `float64` → `0`
- `string` → `""`
- `bool` → `false`

### 2. Slices
Slices are truncated but not nil'd:
```go
receiver.Tags = receiver.Tags[:0]
```
This preserves the underlying array capacity while making the slice empty.

### 3. Maps
Maps are cleared using the built-in `clear()` function:
```go
clear(receiver.Data)
```

### 4. Pointers
Non-nil pointers reset their pointed-to values:
- If the pointed-to type has a `Reset()` method, it will be called
- Otherwise, the value is reset according to the rules above

```go
if receiver.Value != nil {
    if resetter, ok := interface{}(receiver.Value).(interface{ Reset() }); ok {
        resetter.Reset()
    } else {
        *receiver.Value = 0
    }
}
```

### 5. Nested Structs
If a nested struct (via pointer) has a `Reset()` method, it will be called:
```go
if receiver.Child != nil {
    if resetter, ok := interface{}(receiver.Child).(interface{ Reset() }); ok {
        resetter.Reset()
    } else {
        *receiver.Child = ChildStruct{}
    }
}
```

## Example

### Input (metrics.go)
```go
package models

// generate:reset
type TestResetStruct struct {
    Counter int
    Name    string
    Active  bool
    Tags    []string
    Data    map[string]int
    Value   *float64
}
```

### Generated Output (reset.gen.go)
```go
// Code generated by cmd/reset. DO NOT EDIT.

package models

func (receiver *TestResetStruct) Reset() {
    if receiver == nil {
        return
    }

    receiver.Counter = 0
    receiver.Name = ""
    receiver.Active = false
    receiver.Tags = receiver.Tags[:0]
    clear(receiver.Data)
    if receiver.Value != nil {
        if resetter, ok := interface{}(receiver.Value).(interface{ Reset() }); ok {
            resetter.Reset()
        } else {
            *receiver.Value = 0
        }
    }
}
```

## Generated Files

All generated `Reset()` methods for structs in a package are placed in a file named `reset.gen.go` in the same package directory.

## Nil Safety

The generated `Reset()` methods are nil-safe:
```go
func (receiver *MyStruct) Reset() {
    if receiver == nil {
        return
    }
    // ... reset logic
}
```

## Integration

You can integrate this tool into your build process:

1. **Manual generation**: Run `go run cmd/reset/main.go` when needed

2. **go:generate directive**: Add to a Go file in your project:
```go
//go:generate go run ./cmd/reset/main.go
```

Then run:
```bash
go generate ./...
```

3. **Pre-commit hook**: Add to your git pre-commit hook to ensure generated files are up to date

## Limitations

- Only processes `.go` files (excludes `_test.go` and `.gen.go` files during scanning)
- Skips vendor directories and hidden directories (starting with `.`)
- Does not process embedded fields (anonymous fields)
- Arrays are reset to zero value (not element-by-element like the example spec suggests for simplicity)

